{
    "version": "2.0.0",
    "tasks": [
        {
            "label": "🍎 Build iOS Archive",
            "type": "shell",
            "command": "flutter",
            "args": ["build", "ipa", "--release"],
            "group": {
                "kind": "build",
                "isDefault": true
            },
            "presentation": {
                "echo": true,
                "reveal": "always",
                "focus": false,
                "panel": "shared",
                "showReuseMessage": false
            },
            "problemMatcher": ["$flutter"],
            "detail": "Build production iOS archive (.ipa) ready for TestFlight upload"
        },
        {
            "label": "🔄 Bump Version & Build iOS",
            "type": "shell",
            "command": "sh",
            "args": [
                "-c",
                "CURRENT_BUILD=$(grep 'version:' pubspec.yaml | cut -d'+' -f2) && NEW_BUILD=$((CURRENT_BUILD + 1)) && sed -i.bak \"s/version: \\(.*\\)+${CURRENT_BUILD}/version: \\1+${NEW_BUILD}/\" pubspec.yaml && echo \"Version bumped to build ${NEW_BUILD}\" && flutter build ipa --release"
            ],
            "group": "build",
            "presentation": {
                "echo": true,
                "reveal": "always",
                "focus": false,
                "panel": "shared"
            },
            "problemMatcher": ["$flutter"],
            "detail": "Auto-increment build number and create iOS archive"
        },
        {
            "label": "🧪 Test & Build iOS",
            "type": "shell",
            "command": "sh",
            "args": [
                "-c",
                "echo '🧪 Running tests...' && flutter test --reporter failures-only && echo '✅ Tests passed! Building iOS...' && flutter build ipa --release"
            ],
            "group": "build",
            "presentation": {
                "echo": true,
                "reveal": "always",
                "focus": false,
                "panel": "shared"
            },
            "problemMatcher": ["$flutter"],
            "detail": "Run tests first, then build iOS archive (only if tests pass)"
        },
        {
            "label": "🔍 Validate & Build iOS",
            "type": "shell",
            "command": "sh",
            "args": [
                "-c",
                "echo '🔍 Running validation...' && dart tool/test_analyzer.dart --quick && echo '📊 Running Flutter analyze...' && flutter analyze && echo '🍎 Building iOS archive...' && flutter build ipa --release --verbose"
            ],
            "group": "build",
            "presentation": {
                "echo": true,
                "reveal": "always",
                "focus": false,
                "panel": "shared"
            },
            "problemMatcher": ["$flutter", "$dart-analyze"],
            "detail": "Full validation (tests + analysis) then build iOS with verbose output"
        },
        {
            "label": "🚀 Complete TestFlight Pipeline",
            "dependsOrder": "sequence",
            "dependsOn": [
                "Clean Flutter Project",
                "Get Dependencies", 
                "Run Quick Tests",
                "🍎 Build iOS Archive"
            ],
            "group": "build",
            "presentation": {
                "echo": true,
                "reveal": "always",
                "focus": false,
                "panel": "shared"
            },
            "detail": "Complete pipeline: clean → deps → test → build"
        },
        {
            "label": "Clean Flutter Project",
            "type": "shell",
            "command": "flutter",
            "args": ["clean"],
            "group": "build",
            "presentation": {
                "echo": true,
                "reveal": "silent",
                "focus": false,
                "panel": "shared"
            },
            "detail": "Clean Flutter build cache"
        },
        {
            "label": "Get Dependencies",
            "type": "shell", 
            "command": "flutter",
            "args": ["pub", "get"],
            "group": "build",
            "presentation": {
                "echo": true,
                "reveal": "silent",
                "focus": false,
                "panel": "shared"
            },
            "detail": "Get Flutter dependencies"
        },
        {
            "label": "Run Quick Tests",
            "type": "shell",
            "command": "flutter",
            "args": ["test", "--reporter", "failures-only"],
            "group": "test",
            "presentation": {
                "echo": true,
                "reveal": "always",
                "focus": false,
                "panel": "shared"
            },
            "problemMatcher": ["$flutter"],
            "detail": "Run tests with failures-only reporter (matches your existing workflow)"
        },
        {
            "label": "📱 Build iOS Debug",
            "type": "shell",
            "command": "flutter",
            "args": ["build", "ios", "--debug"],
            "group": "build",
            "presentation": {
                "echo": true,
                "reveal": "always",
                "focus": false,
                "panel": "shared"
            },
            "problemMatcher": ["$flutter"],
            "detail": "Build iOS debug version for development"
        },
        {
            "label": "📋 Show Build Info",
            "type": "shell",
            "command": "sh",
            "args": [
                "-c",
                "echo '📋 Build Information:' && echo '===================' && echo 'Current Version:' $(grep 'version:' pubspec.yaml | cut -d' ' -f2) && echo 'Flutter Version:' $(flutter --version | head -1) && echo 'iOS Build Path: build/ios/ipa/' && echo 'Archive Location: build/ios/ipa/noexc.ipa' && echo '' && echo '🍎 TestFlight Upload:' && echo '1. Open Transporter app' && echo '2. Drag build/ios/ipa/noexc.ipa' && echo '3. Click \"Deliver\"'"
            ],
            "group": "build",
            "presentation": {
                "echo": true,
                "reveal": "always",
                "focus": false,
                "panel": "shared"
            },
            "detail": "Show current version and upload instructions"
        },
        {
            "label": "🔧 Open iOS Project in Xcode",
            "type": "shell",
            "command": "open",
            "args": ["ios/Runner.xcworkspace"],
            "group": "build",
            "presentation": {
                "echo": true,
                "reveal": "silent",
                "focus": false,
                "panel": "shared"
            },
            "detail": "Open iOS project in Xcode for advanced configuration",
            "options": {
                "cwd": "${workspaceFolder}"
            }
        }
    ]
}